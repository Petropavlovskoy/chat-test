<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <!-- Подключаем bootstrap-->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css"
      integrity="sha384-r4NyP46KrjDleawBgD5tp8Y7UzmLA05oM1iAEQ17CSuDqnUK2+k9luXQOfXJCJ4I"
      crossorigin="anonymous"
       />
    <title>Чат программа</title>
    <style></style>
    </head>
    <body>
    <div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom shadow-sm">
      <h5 class="my-0 mr-md-auto font-weight-normal">Тестовое задание</h5>
      <nav class="my-2 my-md-0 mr-md-3">
        <a class="p-2 text-dark" href="#">Возможности</a>
        <a class="p-2 text-dark" href="#">Enterprise</a>
        <a class="p-2 text-dark" href="#">Поддержка</a>
        <a class="p-2 text-dark" href="#">Цены</a>
      </nav>
        <a class="btn btn-outline-primary" href="#">Войти</a>
      </div>
     
       <div class="container">
        <div class="py-5 text-center">
          <h2>Чат программы</h2>
        </div>
          <ul id="messages"></ul>
      <div class="col-6">
      <form id="form" action="">
          <div class="name">       
      <label for="message">Имя:</label>
          </div>
      <input type="text" autocomplete="off" name="messages"                         
             id="input" placeholder="Введите сообщение"class="form-control" /> 
          <br />
      <input type="submit" value="Отправить" class="btn btn-danger" />
        </form> 
        <!-- Подключаем Socket.io -->
    <script src="/socket.io/socket.io.js"></script>
     <script>

       // Включаем socket.io и отслеживаем все подключения
      const socket = io();
      
      const messages = document.getElementById("messages");
      const form = document.getElementById("form");
      const input = document.getElementById("input");
      const nameBlock = document.querySelector(".name");
      const userName = prompt("Ваше имя");
      nameBlock.innerHTML = `${userName}`;
      
        let nameArray = localStorage.getItem('name') ?
      JSON.parse(localStorage.getItem('name')) : []     
      localStorage.setItem('name', JSON.stringify(userName))
      console.log(nameArray);

        form.addEventListener("submit", (e) => {
        e.preventDefault();
        if (input.value) {

        //отправка данных на сервер
        socket.emit("chat message", {
            message: input.value,
            name: userName,
        });
            input.value = "";
           }
        });
        
        //адресовываю то что получено из сервера
        socket.on("chat message",  (data) => {
        const item = document.createElement("li");
    
        let messagArray =  localStorage.getItem('messages') ?
      JSON.parse(localStorage.getItem('messages')) : []     
      localStorage.setItem('messages', JSON.stringify(data.message))
      console.log(messagArray);

           item.innerHTML = `<span>${data.name} </span> : ${data.message}`;
        messages.appendChild(item)
       
        window.scrollTo(0, document.body.scrollHeight);
       });
   
    </script>
  </body>
</html>
